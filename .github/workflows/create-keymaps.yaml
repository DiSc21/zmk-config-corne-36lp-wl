name: 'Create ZMK Keymaps'
on:
  workflow_dispatch:  # can be triggered manually
  push:               # automatically run on changes to following paths
    paths:
      - "config/*.keymap"
      - "config/*.dtsi"
      - "keymap/keymap_config.yaml"
      # - 'boards/*/*/*.keymap'

jobs:
  create-keymaps:
    name: Create Corne36 keymaps
    runs-on: ubuntu-latest
    container:
      image: python:3
      volumes:
        - ${{ github.workspace }}:/app
    steps:
      - name: Checkout the repo
        uses: actions/checkout@v2

      - name: Install keymap-drawer
        run: pip install --no-cache-dir keymap-drawer

      - name: Create keymaps
        run: ./keymap/create_keymap_by_layer.sh

      - name: Check output
        id: check_output
        run: is_modified="false"; if [ -n "$(git status --porcelain keymap)" ]; then is_modified="true"; fi; echo "{modified}={${is_modified}}" >> $GITHUB_OUTPUT

      - name: Update changes in GitHub repository
        if: ${{ steps.run_tests.outputs.modified }} == "true"
                - name: Commit changes
        uses: EndBug/add-and-commit@v9
        with:
          author_name: DiSc21
          author_email: dirkschnabel03@aol.com
          message: "[Autogen-Draw-Keymaps]"
          add: 'keymap/*'
